# 全局通用设置：输入/输出/临时目录与断点续跑开关
general:
  input_root: D:/桌面/Deduplication_Framework/mix_dataset # 待处理数据所在目录
  output_root: D:/桌面/Deduplication_Framework/outputs/big_run # 各模态输出与报告目录
  temp_root: D:/桌面/Deduplication_Framework/artifacts/big_run # Orchestrator 产生的阶段日志/状态目录
  resume: true # 是否启用断点续跑（大规模运行建议开启）
  parallel_modalities: true
  # 全局并行 worker 数（按机器资源调整，建议 4-12）
  parallel_workers: 8
  # 每个批次处理的示例数（用于生成 manifest / 分批发送到模态处理器）
  batch_size: 2000

# 全局日志与网络健壮性设置（大规模下载/远程请求时有用）
logging:
  level: INFO
  file: D:/桌面/Deduplication_Framework/logs/big_run.log

network:
  http_read_timeout_seconds: 30
  retries: 5
  backoff_factor_seconds: 1

# 执行器配置：指定本地执行与各阶段使用的 Conda 环境
executor:
  type: local
  conda_executable: C:/Users/sysu/anaconda3/Scripts/conda.exe # 根据实际路径修改
  envs:
    sorter: Deduplication_Framework # 排序阶段使用的环境名称（拼写修正，请确认为你的 env 名称）
    image: image # 图像阶段环境（已安装图像依赖）
    audio: audio # 音频阶段环境（含指纹依赖/ffmpeg）
    text: text-dedup # 文本阶段环境

# 数据质量 / 注入不可用文件（用于模拟损坏样本）
data_quality:
  include_unusable_bins: true
  unusable_bins_path: D:/桌面/Deduplication_framework/mix_dataset/unusable_bins

# 排序阶段：生成 manifest 并统计模态分布
sorter:
  enabled: true
  manifest_name: manifest.csv
  # 分批生成 manifest 时使用的批量大小（适配上面 general.batch_size）
  batch_size: 2000
  move_files: false # 为 true 时会把文件移动到项目内 dataset 目录

# 图像模态：使用轻量 average_rgb 后端避免下载大型模型
image:
  enabled: true
  entrypoint: D:/桌面/Deduplication_framework/pipelines/modalities/image_runner.py
  workdir: .
  output_dir: D:/桌面/Deduplication_Framework/outputs/big_run/image
  args: []
  # 指向单独的 image 配置文件（避免把 YAML 文本直接作为环境变量传递）
  config_file: D:/桌面/Deduplication_framework/configs/image_config.yaml
  # 大规模运行时并发与批次设置
  batch_size: 500
  max_workers: 3
  flush_interval: 100

# 音频模态：默认使用预计算指纹，避免在测试时安装/调用重型依赖
audio:
  enabled: true
  entrypoint: D:/桌面/Deduplication_framework/pipelines/modalities/audio_runner.py
  workdir: .
  output_dir: D:/桌面/Deduplication_Framework/outputs/big_run/audio
  args: []
  env:
    PYTHONIOENCODING: utf-8
  config_file: |
    embedding:
      fingerprint_backend: compute
      precomputed_fingerprints: D:/桌面/Deduplication_framework/artifacts/precomputed_audio_fingerprints.npy  # 指向预生成指纹文件
    dedup:
      method: jaccard
      threshold: 0.75
  # audio-specific processing knobs
  batch_size: 200
  max_workers: 2
  retry_on_decode_error: true
  decode_retry_limit: 3

# 文本模态：默认使用 3-gram + Jaccard 去重
text:
  enabled: true
  entrypoint: D:/桌面/Deduplication_framework/pipelines/modalities/text_runner.py
  workdir: .
  output_dir: D:/桌面/Deduplication_Framework/outputs/big_run/text
  args: []
  config_file: |
    embedding:
      ngram_size: 3
      lowercase: true
    dedup:
      method: jaccard
      threshold: 0.8
  # text processing knobs
  batch_size: 2000
  max_workers: 4
  flush_interval: 200

# 汇总阶段输出：JSON 与 Markdown 报告
report:
  summary_file: D:/桌面/Deduplication_Framework/outputs/big_run/summary.json
  markdown_file: D:/桌面/Deduplication_Framework/outputs/big_run/report.md
  save_intermediate: true
  intermediate_dir: D:/桌面/Deduplication_Framework/outputs/big_run/intermediate
